
To install a package that does not come with the provided environment, please use the following steps:

Install your desired package using the following code:
`install.packages("PackageName", lib="../work/")`
Attach the library you just installed using the following code:
`library(PackageName, lib.loc = "../work/")`
**NOTE:** Make sure the file location is the same as the above code snippets `("../work/")`
Instructions for using the safe_read_csv() function
Purpose: The safe_read_csv() function is designed to verify the existence of datasets for specific questions.

Execution:

**Run the function to attempt loading the dataset into your Vocareum notebook.This function only needs to be run once each time you open the notebook** :
If the dataset loads successfully, you will see a "...successfully read" message. Please proceed with the rest of the questions.
If the dataset is missing, an error message stating "…not found…" will appear.Please report this issue by posting on Piazza so we can resolve it.


```{r}
# The safe_read_csv function is used for checking datasets.
safe_read_csv <- function(file_path, stringsAsFactors = TRUE) {
    result <- tryCatch({
        data <- read.csv(file_path, stringsAsFactors = stringsAsFactors)
        mes <- paste(file_path, " successfully read.")
        print(mes)
        return(data)
      }, warning = function(w) {
    # Warning Message
        message("Warning: ", conditionMessage(w))
        message("Using alternative file path.")
        # Use regular expression to get file name after last slash
        file_name <- sub("^.*/", "", file_path) 
        # See if file in first layer of working directory.
        # If not, student can easily upload it to Vocareum directory.
        result <- read.csv(file_name, stringsAsFactors = stringsAsFactors)
        print("Alternate path successful")
        return(result)
    }, error = function(e) {
    # If neither method was successful
        message("Error: ", conditionMessage(e))
        print("Please upload data to Vocareum")
      }, finally = {
        ## This message appears regardless of whether an error appears
        final_mes <- paste("If ", file_path, " not found, please notify us in Piazza. Thank you.")
        print(final_mes)
    }) 
    return(result)
}
```

## Question 1 (20 Points)
ABC Lab, a manufacturer of cement, is currently developing a new production process. As part of this initiative, the lab routinely creates multiple cement samples daily to evaluate their strength. The provided dataset comprises the strength measurements (in MPa) of eight randomly selected samples from the production line, recorded daily over a period of 59 days. ABC Lab intends to utilize statistical control charts to determine whether the process remains within controlled parameters.

Please use the 'concrete.csv' dataset for this analysis. The dataset includes these columns:

Date: The sequential date identifier for each observation.
Obs1 - Obs8: Measurement of strengths of the 8 randomly selected samples.

```{r}
## read dataset
#data_q1 = read.csv("../resource/asnlib/publicdata/concrete.csv", stringsAsFactors = FALSE) 
data_q1 = safe_read_csv("../resource/asnlib/publicdata/concrete.csv", stringsAsFactors = FALSE) 
str(data_q1)
head(data_q1)
```

### A. Calculate the following control limits: UCLx, LCLx, UCLr, LCLr (8 points)
Note: Use the following values: A_2 = 0.373, D_3 = 0.136, D_4 = 1.864.

```{r}

data_q1$X_bar = rowMeans(data_q1[,3:10])
data_q1$R = apply(data_q1[,3:10], 1, max)-apply(data_q1[,3:10], 1, min)

# Calculate X-double-bar and R-bar.
X_dbl_bar = mean(data_q1$X_bar)
R_bar = mean(data_q1$R)

# Calculate standard deviation of all the observations
Stdv = sd(as.matrix(data_q1[,3:10]))

# Output values for reference
X_dbl_bar
R_bar
Stdv
```


```{r}


# control chart constants
A_2 = 0.373
D_4 = 1.864
D_3 = 0.136

# Calculate the upper control limit and lower control limit for the X-bar chart. Calculate the Center of the two limits.
UCLx = X_dbl_bar + (A_2 * R_bar)
LCLx = X_dbl_bar - (A_2 * R_bar)
CenterX = (UCLx+LCLx)/2

# Calculate the upper control limit and lower control limit for the R chart. Calculate the Center of the two limits.
UCLr = D_4 * R_bar
LCLr = D_3 * R_bar
CenterR = (UCLr+LCLr)/2

# Output values for reference
values <- c(UCLx, LCLx, UCLr, LCLr)
control.limits <- c('UCLx', 'LCLx', 'UCLr', 'LCLr')
data.frame(control.limits, values)
```

The control limits are as follows:
UCLx	39.417750			
LCLx	4.062534			
UCLr	88.340647			
LCLr	6.445455				

### B. Plot X-Bar and R-Bar charts, ensuring that the Upper Control Limit (UCL) and Lower Control Limit (LCL) are clearly indicated on each graph. (8 points)
Identify any points that fall outside the control limits on both the X-Bar and R-Bar(range) charts. Discuss what it means for a point to fall outside the control limits.
Evaluate whether the cement production process is in control based on the control charts.

```{r}
## Plot the R Chart
ggplot(data_q1, aes(x=Date, y=R)) + geom_point() + geom_line() + geom_line(aes(y=LCLr), color="blue") + geom_line(aes(y=UCLr), color="red") + geom_line(aes(y=CenterR), color="orange")+ ggtitle("R Chart")
```

```{r}
sum(data_q1$R > UCLr)
sum(data_q1$R < LCLr)
```


```{r}
ggplot(data_q1, aes(x=Date, y=X_bar)) + geom_point() + geom_line() + geom_line(aes(y=LCLx), color="blue") + geom_line(aes(y=UCLx), color="red") + geom_line(aes(y=CenterX), color="orange") +ggtitle("X-Bar Chart")
```
```{r}
above = which(data_q1$X_bar > UCLx)
data_q1$X_bar[above]
above

```
## ANSWER 
Evaluate whether the cement production process is in control based on the control charts.

The R-Bar chart has all values within the limits, thus it is in control. This means it's only exhibiting common causes of variation.

The X-bar chart has two points falling above the control limit UCL: dates 21 at 41.181 and 40 at 44.767 The process is out of control, meaning there are assignable causes of variation present.

The cement production process is out of control because two points are above the UCLx limit.

### C. If the specification limits were narrowed (e.g., from 30-50 MPa to 35-45 MPa), how would this impact the Cp and Cpk values? What would be the implications for the process? (4 points)
NOte: use all data points to calculate standard deviation.

```{r}
# Calculate Cp
lower_spec = list(30,35)
upper_spec = list(50,45)

Stdv = sd(as.matrix(data_q1[,3:10]))

cp_frame = data.frame(Cp = numeric(), Cpk = numeric())

for(i in list(1,2)){
  Cpi = (upper_spec[[i]] - lower_spec[[i]])/(6*Stdv)
  print(Cpi)
  Cpki = min(((upper_spec[[i]] - X_dbl_bar)/(3*Stdv)), ((X_dbl_bar - lower_spec[[i]])/(3*Stdv)))
  new_row <- data.frame('Cp'=Cpi, 'Cpk'=Cpki)
  cp_frame = rbind(cp_frame, new_row)
}

row.names(cp_frame) <- c('original','narrow')
cp_frame

```
## Answer
Cp is the process capability ratio. With the original window, the CP is less than one, indicating the process is not capable of meeting the upper and lower specification. When the window is more narrow, the value of Cp decreases, meaning that the process is LESS capable of meeting the upper and lower specification, due to the tightened restrictions.

Process capability index, Cpk, gives the proprtion of variation between teh center of hte process and the upper and lower spec. Values for both the original and more narrow margins are less than 1, meaning the process is not capable of meeting the requirement. Due to just common causes of variation, the process is going to create product that is outside your specifications. The value of Cpk is lower in the narrower margin, meaning it is LESS capable of meeting the requirement. It may indicate that just from common causes, the product will fall outside specifications.

##Question 2 (20 points)
You have recently started your role as the Transportation Director in Mountainside Village, which has only one road for entering and exiting. During peak hours, traffic can reach up to 35 cars per hour, and it takes about 1 minute to drive this road without traffic.

###A. Given that the car arrivals are Poisson-distributed and the drive times are exponential, calculate the current utilization rate of the road. (4 points)

```{r}

lambda = 35
mu = 60

rho = lambda/mu
rho

```
## Answer
The current utlization rate is 0.583.

### B. Given the current traffic conditions, what is the probability that 18 cars will arrive within a 20-minute period?(4 points)

```{r}
P18 = (((lambda*(1/3))**18)*exp(-lambda*(1/3)))/factorial(18)
P18
```
## Answer
The probability that exactly 18 cars will arrive within a 20 minute period is 0.0215 or 2.15%.

### C. Assuming the traffic flow increases to 45 cars per hour during peak periods, how does the new utilization rate compare to the previous rate? (4 points)

```{r}
lambda2 = 45

rho2 = lambda2/mu
rho2
```
## Answer
The new utilization rate is 0.75 or 75%, which is much higher than the utilization rate with 35 cars/hour.

### D. Create a graph to show how the time it takes to travel increases as more cars are on the road. (4 points)¶
Hint: Construct a graph to illustrate the relationship between the number of cars per hour (X-axis), ranging from 35 to 45, and the corresponding time spent on the road (Y-axis).

```{r}
cars_per_hour = 35:45

time_on_road = list()

for(i in cars_per_hour){
  Ws = 1/(mu-i)
  time_on_road = append(time_on_road,Ws*60)
}
time_on_road = unlist(time_on_road)
ggplot(mapping = aes(cars_per_hour, time_on_road))+geom_point() + geom_line()

```

## Answer
The graph above shows that an increase in the cars per hour results in a non-linear increase on the time on road.

### E. A new traffic light has been installed, extending the travel time across the road to 10 minutes. Calculate the average number of cars present on the road at any given time. (4 points)
Note: Use the original arrival rate 35 cars/hour.

```{r}
newmu = 6

cars_on_road = lambda/(newmu - lambda)
cars_on_road

```
## Answer
With the new traffic light, there are more cars entering the system than the road can handle, seen as the utilization rate is 5.83, indicating an overloaded and unstable state. The value for $L_s$ is -1.21. This is not a practical system for this road.


