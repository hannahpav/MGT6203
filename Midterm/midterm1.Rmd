
```{r}
library(dplyr)
library(ISLR)
library(regclass)
```

Instructions for Questions 1 – 6
Georgia Tech Bank (GT Bank) just hired you as a consultant, to help them better understand their business. On your first day, you decide to use the “Credit” dataset from the ISLR package, as a proxy, to answer questions about their customer base. Use the “Credit” dataset from the ISLR package, drop the ID column, and model the data (linear-linear model) such that Balance is your dependent variable and the rest of the features (Income, Limit, Rating, Cards, Age, Education, Gender, Student, Married, and Ethnicity) are your independent variables. Use your model to answer questions Q1 through Q6.

 

Data Dictionary for the “Credit” Dataset:


1. Balance: This is the average credit card balance in dollars for each individual.
2. Income: The annual income of the individual in thousands of dollars.
3. Limit: The credit limit on the individual’s credit card.
4. Rating: The individual’s credit rating.
5. Cards: The number of credit cards owned by the individual.
6. Age: The age of the individual.
7. Education: The highest level of education completed by the individual.
8. Gender: The gender of the individual (e.g., “Male” or “Female”).
9. Student: Indicates whether the individual is a student (e.g., “Yes” or “No”).
10. Married: Indicates whether the individual is married (e.g., “Yes” or “No”).
11. Ethnicity: The ethnicity of the individual, which can include categories such as “African American,” “Asian,” and “Caucasian.”

Note: To access it, simply install the ISLR package in R (if you haven't already) and load the dataset using the following commands: install.packages("ISLR")
library(ISLR)
data(Credit)

Credit
## 1-3 Which features are significant at an alpha level of 0.001 ?

```{r}
summary(Credit)
head(Credit)

credituse <- Credit[-1]
cred_mod = lm (Balance ~., data = credituse)
summary(cred_mod)

```
## 4 Which features have a high level of multicollinearity, with a VIF over 5?


```{r}
VIF(cred_mod)
```
## 5 How many influential points are included in the dataset, with a Cook’s distance over 1?

```{r}
cd = cooks.distance(cred_mod)
cookcred = credituse
cookcred$cook = cd
print(cookcred[cd>1,])
```

## 6 Which statement correctly describes the residual vs fitted plot for the model?

```{r}
par(mfrow = c(2, 2))
plot(cred_mod)
```

## 7 Using the same Credit dataset in the ISLR package with Balance as your dependent variable and Income, Rating, and Age as your independent variable, create a linear-linear, log-linear, linear-log, and log-log model. Based on the R-Squared, which model has the best performance? Note: 1) Balance contains 0’s and a 1 needs to be added to the column before you can perform the log transformation (i.e. log(x + 1)). 2)  For both log-log and linear-log models, simply take the log of each independent variable, like log(X1), log(X2), and log (X3).


```{r}
## linear-linear
modelLinLin = lm(Balance~ Income + Rating + Age, data = credituse)
summary(modelLinLin)

## linear-log
modelLinLog = lm(Balance~ log(Income) + log(Rating) + log(Age), data = credituse)
summary(modelLinLog)

## log-linear
modelLogLin = lm(log(Balance + 1)~ Income + Rating + Age, data = credituse)
summary(modelLogLin)

## log-log
modelLogLog = lm(log(Balance+1)~ log(Income) + log(Rating) + log(Age), data = credituse)
summary(modelLogLog)
```

## 8 GT Bank wants you to predict the average credit card balance of Amy Henderson, a new customer to the bank. GT Bank knows that she is a student at Georgia Tech and makes 30,000 at her part time job. Use the Credit dataset from the ISLR package to create a model - that uses Balance as the dependent variable; and Income, Student, and the interaction between Income and Student as independent variables. Then use that model to predict the average credit card balance for Amy Henderson. Round your answer to the nearest dollar.

```{r}
credituse$incstu = credituse$Income * ( as.integer(credituse$Student)-1)
cred_mod_inter = lm(Balance ~ Income + Student + incstu, data=credituse)
summary(cred_mod_inter)

amy = data.frame(Income = 30.000, Student = 'Yes', incstu = 30.000)
predict(cred_mod_inter, amy)

```
# Part 2
Instructions for Questions 9-11
GT Bank wants you to analyze the “Default” dataset from the ISLR package, with the hopes of you uncovering new insights. Download the “Default” dataset from the ISLR package and model the data such that default is your dependent variable and the rest of the features (student, balance, and income) are your independent variables. Use your model to answer questions Q9 through Q11.

 

Data Dictionary for the “Default” Dataset:
1. default: Indicates whether a credit card holder defaulted on their credit card payment. It is a binary variable with two levels: “No” (indicating no default) and “Yes” (indicating default).
2. student: Indicates whether the individual is a student (e.g., “Yes” or “No”).
3. balance: The average credit card balance in dollars for each individual.
4. income: The annual income of the individual in dollars.

## 1 Which interpretation of income is correct?

```{r}
dtable = (Default)
def_mod = glm(default~., data = dtable, family = 'binomial')
summary(def_mod)
```

## 2 What is the probability that Alex who is a student, and has a credit card balance of $2,000 and makes $65,000 annually - will default on her credit card payment? Round your answer to the nearest percentage point.

```{r}

alex = data.frame(student = "Yes", balance = 2000, income = 65000)
lo = predict(def_mod, newdata=alex, price = 'response')
prob_alex = (exp(lo)/(1+exp(lo)))
prob_alex
```
```{r}
hold = exp(-1.087e+01+ -6.468e-01 + 5.737e-03*2000 + 3.033e-06  * 65000)
hold/(1+hold)
```

## 11 What is the AUC for the model?

```{r}
if (!require(ggExtra)) install.packages ("ggExtra")
library(ggExtra)
if (!require(ROCR))install.packages ("ROCR")
library(ROCR)

dtable$prob_model = predict(def_mod, newdata = dtable, type='response')

pred <- prediction(dtable$prob_model, dtable$default)

perf = performance(pred, "tpr","fpr")
plot(perf, colorize=T)

auc.perf <- performance( pred , measure = 'auc')
auc.perf@y.values

```

## 12 GT Bank wants to send promotional material to customers that are at risk of defaulting on their credit card balances, in an attempt to encourage customers to pay off their debt. They have identified four customers to focus on Kim, James, Sam, and Kennedy. Use the same “Default” dataset from the ISLR package, and create a model that uses student and income to predict default. Then use the model to identify which customer has the highest probability of defaulting on their credit card balance. You can find more information about each customer below.

```{r}
d2 = Default[-3]
dmod2 = glm(default ~ student + income, data=d2, family = 'binomial')
summary(dmod2)
```

```{r}
james = data.frame(income = 30000, student = 'Yes')
kim = data.frame(income=55000, student = 'Yes')
sam = data.frame(income = 45000, student = 'No')
kennedy = data.frame( income = 65000, student = 'No')

newframe = data.frame(names = c('james', 'kim', 'sam', 'kennedy'), probs = c(1,2,3,4))
i=1

for(name in list(james, kim, sam, kennedy)){
  o = predict(dmod2, newdata=name, price = response)
  newframe[i,2] = (exp(o)/(1+exp(o)))*100
  i=i+1
}

newframe

```

# Instructions for Questions 13-19
Create a dataset that has monthly returns for the following stocks: TSLA, JNJ, GOOGL, and GE from January 1, 2018 to December 31, 2022 using their "adjusted" price. Create an equally weighted portfolio consisting of these stocks and calculate the monthly returns of your portfolio. Import the Market Returns and Risk-Free Rate dataset and join with your portfolio to obtain the market return (“market return”) and risk-free rate (“risk-free”). 

Hint #1: Recommended R Packages for Use

library(tidyverse)
library(tidyquant)
library(PerformanceAnalytics)
library(xts)
library(lubridate)
library(dplyr)
#Display the data frame
View(myPortfolio)

Hint #2:  The code to retrieve the necessary data from the tidyquant package on R is as follows: 

myPortfolio<- c('TSLA', 'JNJ', 'GOOGL', 'GE') %>% tq_get(get = "stock.prices", from = "2018-01-01", to = "2022-12-31")

#Display the data frame
View(myPortfolio)

Hint #3:  An equally weighted portfolio means that you invest the same proportion of your total investment into each stock. If you have 4 stocks, you'd invest 25% of your total funds into each.

```{r}
library(tidyverse)
library(tidyquant)
library(PerformanceAnalytics)
library(xts)
library(lubridate)
library(dplyr)
```

```{r}
#Display the data frame
risk_free = read.csv("Market_and_RiskFree_Returns_2018_to_2022.csv")
myPortfolio<- c('TSLA', 'JNJ', 'GOOGL', 'GE') %>% tq_get(get = "stock.prices", from = "2018-01-01", to = "2022-12-31")
View(myPortfolio)
```

```{r}
class(myPortfolio$date)
```


## 13 Looking at portfolio monthly returns, how many months did this portfolio exceed a 25% return rate? 

```{r}

stock_returns <- myPortfolio %>% group_by(symbol) %>% tq_transmute(select = adjusted,
                                                              mutate_fun = periodReturn, 
                                                              period = "monthly",
                                                              col_rename = "StockReturns")
weights_1 <- c(0.25, 0.25, 0.25, 0.25)

portfolio_returns <- stock_returns%>%
  tq_portfolio(assets_col= symbol,
               returns_col=StockReturns,
               weights = weights_1,
               col_rename= "StockReturns")
portfolio_returns[portfolio_returns$StockReturns>0.25,]
```

## 14 Utilizing the companies from question above, calculate the following, as a percentage, rounded to four decimal places: 

Portfolio standard deviation 
GE standard deviation 
Portfolio arithmetic average 
GE arithmetic average 

```{r}
#portfolio stdev
StdDev(portfolio_returns$StockReturns)*100

#ge stdev
stock_returns %>% filter(symbol == 'GE') %>% summarize(StdDev(StockReturns)*100)

#portfolio mean
mean(portfolio_returns$StockReturns)*100

#ge mean
stock_returns %>% filter(symbol == 'GE') %>% summarize(mean(StockReturns)*100)

```

## 15 What is the (compounded) cumulative return of the portfolio rounded to the nearest percent?

```{r}
Return.cumulative(portfolio_returns$StockReturns,geometric = TRUE)*100

```
## 16 Calculate TSLA's average monthly excess return relative to the market. Give your answer as a percentage, rounded to two decimal places.

```{r}

TSLA_return = stock_returns %>% filter(symbol == 'TSLA')

mean(TSLA_return$StockReturns - risk_free$market_return)*100


```
## 17 Estimate Beta and Adjusted R2 using a simple linear model for the portfolio return vs the market return.  Which statement has the correct Beta and Adjusted R2 output and corresponding correct interpretation?


```{r}
returnmodel = lm(portfolio_returns$StockReturns ~ risk_free$market_return )
summary(returnmodel)
```
## 18 Create a drawdown chart and table for the portfolio using the Drawdown() functions. Display the top 5 drawdowns to 4 digits.  What statement below is correct?

```{r}

xts_port <- xts(portfolio_returns[,-1],order.by = portfolio_returns[[1]],)

chart.Drawdown(xts_port)
table.Drawdowns(xts_port,top = 5,digits = 4)
```

## 19 In which month is the difference between the portfolio return and the market return the highest?

```{r}

portfolio_returns$diff = portfolio_returns$StockReturns - risk_free$market_return
portfolio_returns[which.max(portfolio_returns$diff),]

```
## 32 Consider a linear regression model estimating the fuel efficiency of a car in terms of miles per gallon of gas (mpg)
based on its origin (region A, B or C) and number of cylinders with the following formula:

Based on this model, if X is the mpg of a car with 6 cylinders originating from region B, 
and Z is the mpg of a car with 5 cylinders originating from region A, what is the value of X - Z rounded to two decimals?

Note:  Round to two decimal places.  Example XX.xx
 
The estimated values of the regression coefficients are provided below:
```{r}
b0 = 39.60 #int
b1 = -4.30 #region B
b2 = 2.68 #region C
b3 = -2.87 #cylinders

X = b0 + b1 + 6*b3
Z = b0 + 5*b3
round((X-Z),2)

```

## 33 Consider the following linear regression model in R:  lm(response ~ pred1 + pred2 + pred3, data = dataset)
Now, consider we would like to evaluate if this model's underlying predictor variables exhibit multi-collinearity.  When testing our predictive variables for multicollinearity, we create a new model in R using just the independent variables of the previous model so that we have:   lm(pred1 ~ pred2 + pred3, data = dataset).  After running this new model, we get an R-Squared of 0.82.  Based on this result, what is the VIF for pred1 using three decimal places?

Note:  Round to three decimal places.  Example XX.xxx

```{r}
rs = 0.82
round(1/(1-rs),3)
```
## 34 Using the following confusion matrix, what is the precision of the model to three decimal places?

Note:  For the confusion matrix below 1 = True and 0 = False

```{r}
TN = 271
TP = 843
FP = 89
FN = 65

precision = TP/(TP+FP)
round(precision,3)
```

## 39 Consider the equation 8.04 log(Y) = 1.85 + 85.4 log(X).  What is the elasticity?

Provide your answer in the context of the following statement: "A 1% increase in X would result in a ___% increase in Y"

Note:  Round to two decimals.  10.444 would round to 10.44 while 10.445 would round to 10.45

```{r}
round(85.4/8.04,2)
```

